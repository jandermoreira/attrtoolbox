%! Package = attrtoolbox
%! Author = Jander Moreira (moreira.jander@gmail.com)
%! Date = 27/04/2025

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{attrtoolbox}[2025/04/27 A toolbox for handling and use of attributes]

\NewDocumentCommand{\ATVersion}{}{0.1}

\ExplSyntaxOn

%
% Package options
\bool_new:N \g_at_readonly_bool
\keys_define:nn { attrtoolbox }{
    readonly .bool_set:N = \g_at_readonly_bool,
}
\keys_set:nn { attrtoolbox }{
    readonly = false,
}
\ProcessKeyOptions

%
%


% ATSetAttribute: sets a named attribute to a class
% #1: class name
% #2: attribute name
% #3: value
\msg_new:nnn { attrtoolbox } { is_readonly } { }
\cs_new:Npn \at_set_attribute:nnn #1#2#3 {
    \bool_if:NTF \g_at_readonly_bool {
        \bool_if_exist:cTF { g_at_ #1 _ #2 _tl } {
            \msg_set:nnn { attrtoolbox } { is_readonly } {
                Attributes~are~set~to~readonly~(class~#1;~attribute~#2)
            }
            \msg_error:nn { attrtoolbox } { is_readonly }
        }{
            \tl_new:c { g_at_ #1 _ #2 _tl }
            \tl_set:cn { g_at_ #1 _ #2 _tl } { #3 }
        }
    }{
        \tl_clear_new:c { g_at_ #1 _ #2 _tl }
        \tl_set:cn { g_at_ #1 _ #2 _tl } { #3 }
    }
}
\NewDocumentCommand{\ATSetAttribute}{ m m > { \TrimSpaces } m }{
    \at_set_attribute:nnn { #1 } { #2 } { #3 }
}

% ATValue: expands an attribute
% #1: class name
% #2: attribute name
\NewDocumentCommand{\ATValue}{ m m }{
    \tl_use:c { g_at_ #1 _ #2 _tl }
}

% ATValue: expands an attribute
% #1: class name
% #2: list of attribute/value pairs
\NewDocumentCommand{\ATSetAttributes}{ m > { \TrimSpaces } m }{
    % todo: processamento de lista de atributos
}

% ATSetList
\NewDocumentCommand{\ATSetList}{ m m m }{}

\ExplSyntaxOff